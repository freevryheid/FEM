      SUBROUTINE BLVALP
C=======================================================================
C     pg 435
C=======================================================================
C
C     TO CALL BLOCK 'VALP'
C     TO COMPUTE EIGENVALUES AND EIGENVECTORS BY THE SUBSPACE
C     ITERATION TECHNIQUE
C=======================================================================
      IMPLICIT REAL*8(A-H,O-Z)
      REAL*4 TBL
      COMMON/ELEM/NUL(4),ME
      COMMON/ASSE/NSYM,NKG,NKE,NDLE
      COMMON/RESO/NEQ
      COMMON/VALP/NITER,NMDIAG,EPSLB,SHIFT,NSS,NSWM,TOLJAC,NVALP
      COMMON/ES/M,MR,MP,M1,M2
      COMMON/LOC/LCORG,LDLNC,LNEQ,LDIMP,LPRNG,LPREG,LLD,LLOCE,LCORE,LNE,
     1           LPRNE,LPREE,LDLE,LKE,LFE,LKGS,LKGD,LKGI,LFG,LRES,LDLG
      COMMON/TRVL/X1,X2,X3,I1,I2,I3,I4,I5
      COMMON VA(1000000)
      DIMENSION TBL(20)
      DATA TBL/4HKGS ,4HKGD ,4HMGS ,4HMGD ,4HFG  ,4HKE  ,4HFE  ,4HDLE ,
     1  4HRES ,4HDLG ,4HP   ,4HLAMB,4HLAM1,4HR   ,4HPHI ,4HKSS ,4HMSS ,
     1  4HV1  ,4HVX  ,4HV2  /,ZERO/0.D0/,EPS/1.D-13/
C----------------------------------------------------------------------
      ABS(X) = DABS(X)
      IF(M1.EQ.0) M1=MR
      IF(M2.EQ.0) M2=ME
      READ(M1,1000) I1,I2,X1,X2,I3,I4,I5,X3
1000  FORMAT(2I5,2F10.0,3I5,1F10.0)
      IF(I1.NE.0) NVALP=I1
      IF(I2.NE.0) NITER=I2
      NSS=I3
      IF(I4.NE.0) NMDIAG=I4
      IF(I5.NE.0) NSWM=I5
      IF(ABS(X1).GT.EPS) EPSLB=X1
      IF(ABS(X2).GT.EPS) SHIFT=X2
      IF(ABS(X3).GT.EPS) TOLJAC=X3
      IF(NSS.NE.0) GO TO 10
      NSS=MIN0(NVALP+8,2*NVALP)
      NSS=MIN0(NSS,NEQ)
10    CONTINUE
      WRITE(MP,2000) M,NVALP,NITER,NMDIAG,EPSLB,SHIFT,NSS,NSWM,TOLJAC
2000  FORMAT(//' SUBSPACE ITERATION (M=',I2,')'/' ',26('=')/
     1  15X,'NUMBER OF DESIRED EIGENVALUES            (NVALP)=',I12/
     2  15X,'MAX. NUMBER OF ITERATIONS PERMITTED      (NITER)=',I12/
     3  15X,'INDEX FOR DIAGONAL MATRIX               (NMDIAG)=',I12/
     4  15X,'CONVERGENCE TOLERANCE ON EIGENVALUES     (EPSLB)=',E12.5/
     5  15X,'SHIFT                                    (SHIFT)=',E12.5/
     6  15X,'SUBSPACE DIMENSION                         (NSS)=',I12/
     7  15X,'MAX. NUMBER OF ITERATION IN JACOBI        (NSHM)=',I12/
     8  15X,'CONVERGENCE TOLERANCE IN JACOBI         (TOLJAC)=',1E12.5/)
      IF(NVALP.LE.NEQ.AND.NSS.LE.NEQ) GO TO 20
      WRITE(MP,2010)
2010  FORMAT(//'---ERROR--- NVALP OR NSS GREATER THAN NEQ',/,
     1        '---STOP EXECUTION---')
      GO TO 30
20    IF(LKGS.EQ.1) CALL ESPACE(NKG,1,TBL(1),LKGS)
      IF(LKGD.EQ.1) CALL ESPACE(NEQ,1,TBL(2),LKGD)
      CALL ESPACE(NKG,1,TBL(3),LMGS)
      CALL ESPACE(NEQ,1,TBL(4),LMGD)
      IF(LFG.EQ.1) CALL ESPACE(NEQ,1,TBL(5),LFG)
      IF(LKE.EQ.1) CALL ESPACE(NKE,1,TBL(6),LKE)
      IF(LFE.EQ.1) CALL ESPACE(NDLE,1,TBL(7),LFE)
      IF(LDLE.EQ.1) CALL ESPACE(NDLE,1,TBL(8),LDLE)
      IF(LRES.EQ.1) CALL ESPACE(NEQ,1,TBL(9),LRES)
      IF(LDLG.EQ.1) CALL ESPACE(NEQ,1,TBL(10),LDLG)
      CALL ESPACE(NEQ*NSS,1,TBL(11),LVEC)
      CALL ESPACE(NSS,1,TBL(12),LLAMB)
      CALL ESPACE(NSS,1,TBL(13),LLAM1)
      CALL ESPACE(NSS*(NSS+1)/2,1,TBL(16),LKSS)
      CALL ESPACE(NSS*(NSS+1)/2,1,TBL(17),LMSS)
      CALL ESPACE(NEQ,1,TBL(18),LV1)
      CALL ESPACE(NSS*NSS,1,TBL(19),LX)
      CALL EXVALP(VA(LLD),VA(LDIMP),VA(LLOCE),VA(LCORE),VA(LPRNE),
     1 VA(LPREE),VA(LNE),VA(LFE),VA(LKE),VA(LKGS),VA(LKGD),VA(LFG),
     2 VA(LCORG),VA(LDLNC),VA(LNEQ),VA(LRES),VA(LDLE),VA(LDLG),
     3 VA(LMGS),VA(LMGD),VA(LVEC),VA(LLAMB),VA(LLAM1),VA(LKSS),VA(LMSS)
     4 ,VA(LV1),VA(LX),NEQ,NSS)
30    RETURN
      END
